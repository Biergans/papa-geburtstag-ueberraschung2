<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Papas Geburtstag â€“ Klickstory ğŸ‰</title>
  <style>
    :root{--bg1:#0b1020;--bg2:#1a2a6c;--card:rgba(255,255,255,.10);--border:rgba(255,255,255,.18);--text:rgba(255,255,255,.92);--muted:rgba(255,255,255,.72)}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;display:grid;place-items:center;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
      background:radial-gradient(1200px 800px at 15% 15%,#2b86c5 0%,transparent 55%),
               radial-gradient(1000px 700px at 85% 25%,#784ba0 0%,transparent 55%),
               linear-gradient(135deg,var(--bg1),var(--bg2));
      overflow:hidden;padding:24px}
    canvas{position:fixed;inset:0;pointer-events:none;z-index:1}
    .card{width:min(860px,100%);background:var(--card);border:1px solid var(--border);border-radius:26px;padding:26px;backdrop-filter:blur(10px);
      box-shadow:0 10px 45px rgba(0,0,0,.38);position:relative;z-index:2}
    .badge{display:inline-flex;gap:10px;align-items:center;padding:8px 12px;border-radius:999px;border:1px solid var(--border);
      background:rgba(255,255,255,.06);color:var(--muted);font-size:14px;margin-bottom:12px}
    h1{margin:0 0 8px;font-size:clamp(26px,4.2vw,44px);letter-spacing:-.02em}
    .stage{margin-top:14px;border-radius:18px;border:1px solid var(--border);background:rgba(0,0,0,.18);padding:18px;min-height:310px;
      display:grid;align-content:start;gap:14px;overflow:hidden;position:relative}
    .msg{font-size:18px;color:rgba(255,255,255,.95);white-space:pre-wrap;line-height:1.55}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;align-items:center;justify-content:space-between}
    button{padding:12px 16px;border-radius:14px;border:1px solid rgba(255,255,255,.22);background:rgba(255,255,255,.14);color:var(--text);
      font-size:16px;cursor:pointer;user-select:none}
    .hint{font-size:13px;color:rgba(255,255,255,.55)}
    .popper{position:absolute;right:14px;top:14px;font-size:28px;opacity:0;pointer-events:none}
    .popper.run{animation:popper 700ms ease-out}
    @keyframes popper{0%{opacity:0;transform:translateY(-10px) scale(.7) rotate(-10deg)}30%{opacity:1;transform:translateY(0) scale(1.05) rotate(8deg)}100%{opacity:0;transform:translateY(-6px) scale(.95) rotate(-6deg)}}
    .wiggle{animation:wiggle 420ms ease-in-out}
    @keyframes wiggle{0%{transform:rotate(0)}25%{transform:rotate(-3deg)}50%{transform:rotate(3deg)}75%{transform:rotate(-2deg)}100%{transform:rotate(0)}}
    #giftTrap{position:absolute;left:50%;top:64%;transform:translate(-50%,-50%);display:none}
    #giftTrap.show{display:inline-block}
    .note{display:none;padding:12px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.08);color:rgba(255,255,255,.88);font-size:14px}
    .note.show{display:block}
    .fun{display:none;padding:14px;border-radius:16px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06)}
    .fun.show{display:block}
    .cake{font-size:64px;display:inline-block;animation:bounce 1s ease-in-out infinite}
    @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-18px)}}
  </style>
</head>
<body>
<canvas id="confetti"></canvas>

<main class="card">
  <div class="badge">ğŸ“œ Klickstory â€¢ jede Seite = neue Ãœberraschung</div>
  <h1>FÃ¼r Papa â¤ï¸</h1>

  <section class="stage" id="stage" aria-live="polite">
    <div class="popper" id="popper">ğŸ‰</div>
    <div class="msg" id="msg">Lade Storyâ€¦</div>

    <div class="fun" id="fun">
      <div class="cake">ğŸ‚</div>
      <div class="hint">Der Kuchen hÃ¼pft, weil er weiÃŸ: Heute ist Papas Tag ğŸ˜„</div>
    </div>

    <div class="note" id="note">ğŸ Erst â€Geschenk auspackenâ€œ erwischen!</div>
    <button id="giftTrap">Geschenk auspacken ğŸ</button>

    <div class="hint" id="progress"></div>
  </section>

  <div class="controls">
    <button id="nextBtn">Weiter ğŸ‘‰</button>
    <button id="restartBtn">Nochmal ğŸ”</button>
  </div>

  <div class="hint">Tipp: Leertaste oder Enter geht auch.</div>
</main>

<script>
(() => {
  // ===== Konfetti =====
  const canvas = document.getElementById("confetti");
  const ctx = canvas.getContext("2d");
  let W,H,particles=[],animId=null;
  const rand=(a,b)=>Math.random()*(b-a)+a;
  function resize(){ W=canvas.width=innerWidth; H=canvas.height=innerHeight; }
  addEventListener("resize", resize); resize();

  function burst(){
    for(let i=0;i<140;i++){
      particles.push({x:rand(0,W),y:rand(-30,H*0.25),vx:rand(-2.2,2.2),vy:rand(2.6,6.6),
        size:rand(4,10),rot:rand(0,Math.PI*2),vr:rand(-0.15,0.15),life:rand(70,140),hue:rand(0,360)});
    }
    if(!animId) anim();
  }
  function anim(){
    ctx.clearRect(0,0,W,H);
    particles = particles.filter(p=>p.life>0);
    for(const p of particles){
      p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; p.vy+=0.03; p.vx*=0.995; p.life-=1;
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
      ctx.fillStyle=`hsl(${p.hue} 90% 60%)`;
      ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.7);
      ctx.restore();
    }
    if(particles.length) animId=requestAnimationFrame(anim);
    else { cancelAnimationFrame(animId); animId=null; }
  }

  // ===== Story =====
  const msg = document.getElementById("msg");
  const popper = document.getElementById("popper");
  const stage = document.getElementById("stage");
  const fun = document.getElementById("fun");
  const note = document.getElementById("note");
  const giftTrap = document.getElementById("giftTrap");
  const progress = document.getElementById("progress");
  const nextBtn = document.getElementById("nextBtn");
  const restartBtn = document.getElementById("restartBtn");

  let giftUnlocked = false;
  let i = 0;

  const pages = [
    {type:"text", pop:"ğŸ‚", text:`Hallo Papa,
da ich heut nicht da sein kann, um mit euch deinen Geburtstag zu feiern,
Ã¼bermittel ich dir hiermit nochmal:
ALLES GUTE ZUM GEBURTSTAG! ğŸ¥³`},
    {type:"fun", pop:"ğŸ˜‚", text:"Kurze Unterbrechungâ€¦ Zeit fÃ¼r eine absolut seriÃ¶se Geburtstags-Animation ğŸ˜„"},
    {type:"giftGate", pop:"ğŸ", text:"Okay Papaâ€¦ jetzt kommt das Geschenk. Aber erst musst du esâ€¦ FANGEN. ğŸ˜„"},
    {type:"text", pop:"ğŸ€", requiresGift:true, text:`Da ich die letzten Tage/Wochen von dir und Mama darauf hingewiesen wurde,
dass du dich sehr Ã¼ber Tickets zum Basketballspiel in WÃ¼rzburg (Baskets) freuen wÃ¼rdest,
habe ich mir Ã¼berlegt:

Ich lade alle (Max, Meli, Mama und dich) zu einem Spiel ein! ğŸŸï¸ğŸ‰`},
    {type:"text", pop:"ğŸ“…", requiresGift:true, text:`Wir kÃ¶nnen ja mal zusammen nach einem Termin suchen,
an dem alle Zeit haben.

Ich bin bereit â€“ du sagst nur: "Wann?" ğŸ˜„`},
    {type:"final", pop:"ğŸ”¥", requiresGift:true, text:"Finale! ğŸŠ HAPPY BIRTHDAY, Papa! (EXTRA Konfetti!)"}
  ];

  function transition(emoji){
    popper.textContent = emoji || "ğŸ‰";
    popper.classList.remove("run"); void popper.offsetWidth; popper.classList.add("run");
    stage.classList.remove("wiggle"); void stage.offsetWidth; stage.classList.add("wiggle");
    burst();
  }

  function show(idx){
    const p = pages[idx];
    msg.textContent = p.text;

    fun.classList.remove("show");
    note.classList.remove("show");
    giftTrap.classList.remove("show");

    transition(p.pop);

    if(p.type === "fun") fun.classList.add("show");
    if(p.type === "giftGate"){
      note.classList.add("show");
      giftTrap.classList.add("show");
      centerGift();
    }
    if(p.type === "final"){
      setTimeout(burst, 250);
      setTimeout(burst, 650);
    }

    progress.textContent = `Seite ${idx+1} von ${pages.length}`;
    nextBtn.textContent = (idx === pages.length-1) ? "Ende âœ…" : "Weiter ğŸ‘‰";
  }

  function centerGift(){
    const rect = stage.getBoundingClientRect();
    giftTrap.style.left = `${Math.max(12, rect.width/2 - 90)}px`;
    giftTrap.style.top  = `${Math.max(70, rect.height*0.62)}px`;
    giftTrap.style.transform = "translate(0,0)";
  }

  function moveGiftAway(){
    const rect = stage.getBoundingClientRect();
    const b = giftTrap.getBoundingClientRect();
    const pad = 12;
    const maxX = rect.width - b.width - pad;
    const maxY = rect.height - b.height - pad;
    const x = Math.floor(rand(pad, Math.max(pad, maxX)));
    const y = Math.floor(rand(pad+60, Math.max(pad+60, maxY)));
    giftTrap.style.left = `${x}px`;
    giftTrap.style.top  = `${y}px`;
    burst();
  }

  stage.addEventListener("mousemove", (e) => {
    if(!giftTrap.classList.contains("show")) return;
    const b = giftTrap.getBoundingClientRect();
    const d = Math.hypot(e.clientX-(b.left+b.width/2), e.clientY-(b.top+b.height/2));
    if(d < 120) moveGiftAway();
  });
  giftTrap.addEventListener("mouseenter", moveGiftAway);

  giftTrap.addEventListener("click", () => {
    giftUnlocked = true;
    giftTrap.classList.remove("show");
    note.classList.remove("show");
    msg.textContent = "âœ… Geschenk freigeschaltet! Papa, Reflexe wie ein Point Guard! ğŸ˜„";
    transition("ğŸŠ");
    setTimeout(() => { if(i < pages.length-1){ i++; show(i); } }, 700);
  });

  function next(){
    const ni = i + 1;
    if(ni < pages.length && pages[ni].requiresGift && !giftUnlocked){
      msg.textContent = "â›” Halt! Erst den Button â€Geschenk auspackenâ€œ erwischen ğŸ˜„";
      note.classList.add("show");
      transition("ğŸ§¨");
      return;
    }
    i = Math.min(i+1, pages.length-1);
    show(i);
  }

  function restart(){
    i = 0;
    giftUnlocked = false;
    show(i);
  }

  nextBtn.addEventListener("click", () => { if(i < pages.length-1) next(); else burst(); });
  restartBtn.addEventListener("click", restart);
  addEventListener("keydown", (e) => {
    if(e.key === " " || e.key === "Enter"){
      e.preventDefault();
      if(i < pages.length-1) next();
    }
  });

  // Start
  show(0);
})();
</script>
</body>
</html>
